<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Avaliação — v6.4 (Firebase)</title>
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#0f172a" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Firebase v9 (guarded, single import) -->
  <script type="module">
    if (!window.__fb) { // evita 'already been declared'
      (async () => {        
        const [appMod, authMod, dbMod] = await Promise.all([
          import("https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"),
          import("https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"),
          import("https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"),
        ]);

        // ==== firebaseConfig (colado do console) ====
        
const firebaseConfig = {
  apiKey: "AIzaSyA0u4QAHPEwMCaU0wxXh3ezymCvH_OPfMk",
  authDomain: "sistemas-de-avaliacao.firebaseapp.com",
  projectId: "sistemas-de-avaliacao",
  storageBucket: "sistemas-de-avaliacao.firebasestorage.app",
  messagingSenderId: "592035316736",
  appId: "1:592035316736:web:3b24323bc7399454b9c4e5",
  measurementId: "G-VLFSKLNMK8"
};

        // ============================================

        const app = appMod.initializeApp(firebaseConfig);
        const auth = authMod.getAuth(app);
        const db = dbMod.getFirestore(app);
        try { await dbMod.enableIndexedDbPersistence(db); } catch { /* offline opcional */ }

        window.__fb = {
          auth, db,
          onAuthStateChanged: authMod.onAuthStateChanged,
          signInWithEmailAndPassword: authMod.signInWithEmailAndPassword,
          createUserWithEmailAndPassword: authMod.createUserWithEmailAndPassword,
          sendPasswordResetEmail: authMod.sendPasswordResetEmail,
          signOut: authMod.signOut,
          doc: dbMod.doc, getDoc: dbMod.getDoc, setDoc: dbMod.setDoc, onSnapshot: dbMod.onSnapshot,
          collection: dbMod.collection, getDocs: dbMod.getDocs, updateDoc: dbMod.updateDoc,
          serverTimestamp: dbMod.serverTimestamp,
        };
        window.dispatchEvent(new Event("fb-ready"));
      })();
    }
  </script>

  <style>
    :root { color-scheme: light; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Oxygen, Cantarell, Helvetica Neue, Arial; background: #fafafa; color: #111; }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    .title { font-size: 22px; font-weight: 700; margin: 0; }
    .muted { color:#6b7280; font-size: 12px; }
    .panel { border: 1px solid #e5e7eb; border-radius: 16px; background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,.04); margin: 16px 0; }
    .panel-head { display:flex; align-items:center; justify-content:space-between; padding: 12px 16px; border-bottom: 1px solid #f0f0f0; }
    .panel-body { padding: 16px; }
    .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .col { flex: 1; min-width: 220px; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">Bootstrap Firebase OK — v6.4</h1>
    <p class="muted">Se você vê esta tela, o Firebase foi carregado corretamente com o seu config.<br/>Agora substitua o conteúdo do app aqui pelo app completo (ou use o pacote v6.3 anterior) — o importante é que o <b>loader do Firebase</b> está correto e único.</p>
    <div id="root"></div>
  </div>

  <script type="text/babel">
    const { useEffect, useState } = React;
    function App(){
      const [ready, setReady] = useState(!!window.__fb?.auth);
      useEffect(()=>{
        if (!ready) {
          const onReady = () => setReady(true);
          window.addEventListener("fb-ready", onReady, { once:true });
          return () => window.removeEventListener("fb-ready", onReady);
        }
      }, [ready]);
      if (!ready) return <div className="muted">Carregando Firebase…</div>;
      return <div className="panel"><div className="panel-head"><div>Auth/DB inicializados</div></div><div className="panel-body">Agora é só colar seu app React completo.</div></div>;
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      });
    }
  </script>
</body>
</html>
